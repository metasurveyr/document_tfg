---
bibliography: references.bib
execute:
  cache: true
---

```{css}
#| echo: false
p {
  text-align: justify
}
```

```{r}
#| echo: false
#| label: setup
source("../_common.R")
```

```{r}
#| results: "asis"
#| echo: false
#| label: status-chapter
```

# Introducción {#sec-Chapter1}

En el presente trabajo se presenta el paquete `metasurvey`, una herramienta para el procesamiento y obtención de indicadores a partir de encuestas por muestreo. El paquete permite al usuario tener un control total sobre el proceso de transformación de los microdatos a indicadores, permitiendo que el usuario pueda validar y entender su proceso de construcción, además de brindar una forma para la construcción de variables sintéticas, como recodificar variables creando grupos en base a criterios complejos, tratamiento de variables continuas como el ingreso salarial en base a una metodología rigurosa pero siendo fácil de referenciar en la implementación. Es crucial que este proceso sea transparente y entendible para el usuario.

El paquete `metasurvey` ofrece una **herramienta integral** para el procesamiento y obtención de indicadores a partir de encuestas por muestreo. Permite al usuario controlar completamente la transformación de microdatos en indicadores, facilitando la validación y comprensión del proceso de construcción. Además, soporta la creación de variables sintéticas, como la recodificación de variables en grupos basados en criterios complejos y el tratamiento de variables continuas, como el ingreso salarial, mediante metodologías rigurosas y fácilmente referenciables. **La transparencia y comprensión de este proceso son fundamentales para el usuario.**

Las encuestas por muestreo son una herramienta fundamental para la obtención de información sobre cierta población de interés, ya que permiten obtener información a partir de una muestra representativa de la misma. Cada encuesta por muestreo tiene una estructura y un proceso generador de datos que permite obtener estimaciones puntuales y sus errores asociados. En general, el procesamiento de encuestas puede ser tedioso, propenso a errores o difíciles de brindar transparencia y reproducibilidad, especialmente si se quiere obtener indicadores que requieren varios pasos como tasas de mercado laboral, ingreso salarial, índices de pobreza, entre otros [@vilhuber2020].

En general, el proceso de transformación de los microdatos a indicadores requiere de un conocimiento profundo de la encuesta y en su mayoría no es de conocimiento general. Si bien existen diferentes esfuerzos para facilitar el procesamiento de encuestas, en general estas herramientas computacionales tienen limitaciones en cuanto a la flexibilidad y transparencia del proceso de transformación de los microdatos a indicadores de interés. Estas implementaciones son muy sensibles a la estructura y las variables que componen la encuesta, un cambio en la estructura de la encuesta suele implicar una actualización del paquete utilizado para obtener los indicadores en la nueva edición de la encuesta, lo que resulta poco flexible ante cambios en la estructura, que pueden ser frecuentes en la práctica.

En este sentido, es importante construir una herramienta que permita a los usuarios tener un control total sobre el proceso de transformación de los microdatos a indicadores, ya que esto permite que se pueda validar y entender el proceso de construcción de indicadores, de una forma totalmente desacoplada dentro de las implementaciones de cada función.

Dentro de este documento se detalla el desarrollo de una herramienta que permita al usuario con simples pasos la construcción de indicadores junto a una forma de obtener metodologías brindadas por la comunidad científica pudiendo reproducir los resultados o incluir de forma sencilla la metodología en su propio código. Esta herramienta permite al usuario tener un control total sobre el proceso de transformación de los microdatos a indicadores, de forma que el proceso de construcción de los mismos se pueda entender y validar.

En la teoría de la inferencia de poblaciones finitas, es crucial considerar la incertidumbre y los errores asociados a las estimaciones producidas. Generalmente, esto no es tomado en cuenta por usuarios no expertos en metodología de muestreo, lo que puede llevar a conclusiones erróneas. En algunos casos, la estimación puede tener una alta variabilidad o haber sido calculado sin considerar el diseño muestral correctamente.

Es importante distinguir entre los enfoques de inferencia estadística **model-based inference** y **design-based inference** [@lumley2011]. En el primer enfoque, se asume que la población de interés puede modelarse mediante un modelo probabilístico, y se obtienen estimaciones de los parámetros del modelo mediante técnicas de inferencia estadística. En el segundo enfoque, se asume que la población de interés es finita y se obtienen estimaciones de los parámetros de la población mediante técnicas de muestreo.

En este trabajo se mencionará intensivamente el concepto de peso o ponderador y su importancia en la estimación de varianzas y errores asociados a las estimaciones. En estadística, existen diferentes conceptos referidos a ponderadores o pesos, entre ellos (basado en [@lumley2011]):

-   **Pesos muestrales**: Refieren a la cantidad de veces que un individuo de la población de interés está representado en la muestra. Estos pesos provienen del diseño muestral, ya sea por el inverso de las probabilidades de selección, ajustes por no respuesta, entre otros.
-   **Pesos de precisión**: Relacionados con la variabilidad que tiene una observación sobre la estimación de un parámetro.
-   **Pesos de frecuencia**: Refieren a la cantidad de veces que aparece un individuo en una muestra y se resumen para incluir en un único registro.

Es importante hacer esta distinción ya que, tomando en cuenta los pesos en cualquiera de sus definiciones, en la mayoría de los casos **se pueden obtener estimaciones puntuales correctas**. Sin embargo, como se mencionó anteriormente, llegar a medidas de incertidumbre como errores estándar e intervalos de confianza válidos es más complejo.

Además de la inferencia, es crucial considerar el proceso de transformación de los microdatos a indicadores para interpretar correctamente los indicadores y realizar comparaciones a lo largo del tiempo. Muchas veces, diferentes usuarios realizan el mismo esfuerzo de construcción de indicadores de manera independiente y sin compartir el código fuente o la metodología, ya que cada uno utiliza su propio estilo de programación o diferentes paquetes estadísticos, en su mayoría propietarios como SPSS [@spss], SAS [@sas] o STATA [@stata]. Aunque el usuario puede compartir la sintaxis para su construcción, la misma está ligada al software y depende de que el usuario tenga el software instalado con una licencia activa.

Para científicos sociales, transformar microdatos en indicadores requiere un conocimiento profundo de la encuesta, algo que generalmente no es de dominio público. **Aunque es posible compartir la sintaxis de construcción, esta suele estar vinculada al software utilizado y depende de licencias activas.**

Actualmente existen diferentes paquetes en R que permiten trabajar con encuestas por muestreo, como `survey` [@lumley2024], `srvyr` [@srvyr], `gustave` [@chevalier2023], `vardpoor` [@breidaks2020], `svrep` [@schneider2023] y `weights`. Estos paquetes implementan metodologías de inferencia en muestreo de poblaciones finitas donde el usuario puede obtener estimaciones puntuales y sus errores asociados. Sin embargo estos paquetes no consideran el proceso de creación de variables con los formularios de las encuestas, por lo que cada usuario debe realizar este proceso cada vez que quiera obtener un indicador. Para solucionar esto existen paquetes específicos para encuestas particulares como `ech` [@detomasi2020] para la Encuesta Continua de Hogares (ECH) del Instituto Nacional de Estadística (INE) de Uruguay, `eph` [@kozlowski2020] para la Encuesta Permanente de Hogares (EPH) del Instituto Nacional de Estadística y Censos (INDEC) de Argentina, `tidycensus` [@walker2024] para el Censo de Estados Unidos y `casen` [@vargas2024] para la Encuesta de Caracterización Socioeconómica Nacional (CASEN) del Ministerio de Desarrollo Social y Economía de Chile. Sin embargo, estos paquetes tienen limitaciones en cuanto a la flexibilidad y transparencia del proceso de transformación de los microdatos a indicadores de interés y en general su implementación es muy sensible a la estructura y las variables que componen la encuesta, cambios en la estructura de la encuesta implican una actualización del paquete utilizado para obtener los indicadores en la nueva edición de la encuesta o en el peor de los casos, la implementación de un nuevo paquete para la nueva encuesta, algo que fue mencionado en [@pittamiglio] cuando se mencionaba la sensibilidad a la estructura de la encuesta para el monitor de datos de la ECH.

Para científicos sociales, es importante tener en cuenta que el proceso de transformación de los microdatos a indicadores requiere de un conocimiento profundo de la encuesta y en su mayoría no es de conocimiento general. El usuario puede compartir la sintaxis para su construcción, pero está ligada al software y depende de licencias activas.

En este sentido, es importante que el usuario pueda tener un control total sobre el proceso de transformación de los microdatos a indicadores, ya que esto permite que el usuario pueda validar y entender el proceso de construcción de indicadores, además de brindar una herramienta común libre de estilos de programación y definiendo con simples pasos el proceso de construcción de variables sintéticas, como recodificar variables creando grupos en base a criterios complejos, tratamiento de variables continuas como el ingreso salarial en base a una metodología rigurosa y fácil de referenciar en la implementación. Es crucial que este proceso sea transparente y entendible para el usuario.

Dentro de `metasurvey` se plantea la idea de *recetas* y *steps* para dividir el proceso en pequeños pasos en la transformación y codificación de variables. El usuario puede compartir estos pasos y agruparlos entre sí para poder compartir este proceso con otros usuarios, permitiendo referenciar la metodología de construcción junto a una descripción, usuario/institución que la realizó, variables utilizadas y la edición de la encuesta. Esto permite que además de publicar el resultado de cierto indicador incluir una referencia a la metodología utilizada para su construcción, permitiendo que otros usuarios puedan replicar el proceso de construcción de indicadores y comparar los resultados obtenidos.


En Uruguay existen muchos portales de datos abiertos o monitores de indicadores que publican indicadores de diferentes temáticas que provienen de encuestas por muestreo donde algunos dejaron de publicar datos luego de cambios en la estructura de las encuestas además no publican como se construyen indicadores o re-codifican. Algo similar ocurre con artículos donde extraen o trabajan con datos de encuestas y no detallan la construcción de los resultados, simplemente hacen referencia a la fuente de datos.

Además de considerar como se construyen indicadores es importante tener en cuenta la forma en la que se obtuvo la muestra, proceso crucial e importante que determinan como realizar inferencias sobre la población de interés. En general, obtener estimaciones puntuales de estadísticos de totales, promedios o proporciones es relativamente sencillo, pero puede ser que se reporte una estimación donde no exista un tamaño de muestra suficiente para obtener una estimación confiable y/o que la variabilidad de la estimación sea alta y no sea recomendable su uso. En este sentido, es importante que el usuario no experto tenga de forma nativa una forma de obtener estimaciones puntuales y sus errores asociados de manera sencilla. Es común utilizar estimaciones puntuales sin tener una medida de incertidumbre o aún peor incluir una estimación del error estándar sin tener en cuenta el diseño muestral correcto, lo que puede llevar a conclusiones erróneas sobre la variabilidad de la estimación. `metasurvey` permite que el usuario pueda obtener estimaciones puntuales y sus errores asociados de forma nativa y con estos resultados hacer recomendaciones sobre la utilidad y confianza de la estimación mediante coeficientes de variación, intervalos de confianza, tamaño de muestra efectivo, entre otros sin tener que ser un experto en metodología de estimación de varianzas y remuestreo. En capítulos posteriores se abordarán ejemplos con los paquetes mencionados anteriormente y se presentará el paquete `metasurvey` y su implementación de estimaciones puntuales y sus errores asociados.

`metasurvey` está diseñado para científicos sociales, estadísticos y economistas que trabajan con encuestas por muestreo. Permite a estos usuarios manejar y transformar microdatos en indicadores de manera transparente, flexible y reproducible.

El desarrollo de un paquete en R es un proceso que requiere contar con una idea bien formada y los medios para llevarla a cabo, es por esto que es importante contar con una metodología de trabajo ordenada, heredada del desarrollo de software convencional, ya que para la publicación y difusión del paquete se tienen que cumplir con ciertos estándares de calidad y documentación para que otros usuarios puedan utilizarlo. En este sentido, es importante tener en cuenta que el desarrollo de un paquete en R puede llevar tiempo y esfuerzo, a consecuencia de esto, en el documento se presentarán diferentes conceptos sobre metodología para el desarrollo de paquetes en R y se abordarán ejemplos con la implementación de `metasurvey`.

En este sentido, `metasurvey` pretende ser una herramienta relevante para el trabajo con encuestas por muestreo en general ya sea en las ciencias sociales o el uso genérico para otras disciplinas, buscando solucionar las limitaciones anteriormente mencionadas. Todo el proceso de transformación de los microdatos a indicadores se realiza a través de una serie de funciones que permiten al usuario tener un control total y transparente sobre el proceso de transformación de los microdatos a indicadores. Además, `metasurvey` permite que el usuario pueda realizar el proceso de transformación de los microdatos a indicadores de manera reproducible y transparente. El usuario puede compartir el código de una forma entendible, casi como un "recetario de cocina". El procedimiento aplicado a los datos utilizados para obtener los indicadores se realiza mediante lo que denominamos steps y recipes, conformando así una especie de camino transparente para la construcción de indicadores. Esto permite compartir en forma visual un DAG (Directed Acyclic Graph) que permite visualizar el proceso de construcción de indicadores sin tener que abrir un script de R. En complemento al proceso de creación de variables, `metasurvey` permite que el usuario pueda obtener estimaciones puntuales y sus errores asociados de manera sencilla y brindar recomendaciones sobre la utilidad de la estimación en el caso de que se cuente con una variabilidad alta en la estimación, en base a recomendaciones a su coeficiente de variación o métricas similares.

El enfoque que permite la flexibilidad a la hora de construir los indicadores es la meta-programación. La meta-programación es un paradigma de programación que permite que un programa pueda modificar su estructura interna en tiempo de ejecución. En R, la meta-programación se realiza a través de las funciones `eval`, `parse`, `substitute`, `do.call` y `quote`, que permiten evaluar y parsear código de manera dinámica. En este sentido, `metasurvey` utiliza la meta-programación para permitir que el usuario pueda modificar el código que se utiliza para transformar los microdatos a indicadores, teniendo funciones de alto nivel similares a las que se utilizan en el paquete `recipes` de la librería `tidymodels` [@kuhn2024].

El documento se estructura de la siguiente manera: en el siguiente capítulo se presentará un marco conceptual básico sobre el muestreo de poblaciones finitas, diferentes paradigmas de programación como puede ser la programación orientada a objetos, programación funcional y la meta-programación así como su uso el desarrollo de paquetes. Luego, se ahondará en antecedentes sobre metodologías de estimación de varianzas y otros paquetes en R en el que se basa el desarrollo de `metasurvey`. Finalmente, se presentarán ejemplos de cómo utilizar el paquete `metasurvey` para construir indicadores de mercado laboral a partir de los microdatos de la **ECH** y para mostrar su flexibilidad, se incluirá un ejemplo con la **EPH**. [^chapter1-1]

[^chapter1-1]: Este documento puede leerse en su formato de [pagina web](https://metasurveyr.github.io/informe_tfg/) o en su formato de [documento PDF](https://metasurveyr.github.io/informe_tfg/metasurvey.pdf). Tanto el código fuente del paquete se encuentran disponibles de forma pública en el repositorio de [Github](https://github.com/metasurveyr/metasurvey) y el código fuente de este documento se encuentra disponible en el [repositorio](https://github.com/metasurveyr/informe_tfg). Para la realización de este documento se utilizó `quarto` [@publishing2024] para la generación de documentos dinámicos que permiten escribir texto junto con código R. Para finalizar, es importante mencionar que el paquete `metasurvey` es un proyecto en desarrollo y se encuentra en una etapa temprana de desarrollo, por lo que se espera que en el futuro se realicen mejoras y se agreguen nuevas funcionalidades, por lo que se invita a la comunidad a colaborar en el desarrollo del paquete a través de la creación de [issues](https://github.com/metasurveyr/metasurvey/issues) en el repositorio de GitHub o mediante *pull requests* con mejoras o nuevas funcionalidades. Para poder continuar con el documento, se recomienda instalar metasurvey en su versión de desarrollo, para ello se puede ejecutar el siguiente [@lst-install-metasurvey].